<!doctype html>
<html> 
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Watchlist</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <main class="container">
    <header class="topbar">
      <div>
        <h1 class="title">My Watchlist</h1>
        <p class="muted small">My personal tracker for shows</p>
      </div>

      <nav class="tabs" aria-label="Watchlist sections">
        <a class="tab" href="#home" id="tab-home">Home</a>
        <a class="tab" href="#browse" id="tab-browse">Browse</a>
        <a class="tab" href="#collection" id="tab-collection">My Collection</a>
      </nav>
    </header>

    <!-- Auth -->
    <section class="card" id="authCard">
      <h2>Login</h2>
      <div class="row">
        <input id="email" type="email" placeholder="you@email.com" />
        <button id="sendLink">Send magic link</button>
        <button id="logout" class="secondary" style="display:none;">Logout</button>
      </div>
      <p id="authMsg" class="muted"></p>
    </section>

    <!-- HOME -->
    <section class="card " id="view-home" style="display:none;">
      <h2>Home</h2>

      <!-- optional: we’ll wire these later -->
      <div class="homeGrid">
        <div class="miniCard">
          <div class="kpiLabel muted">To Watch</div>
          <div class="kpiValue" id="kpiToWatch">–</div>
        </div>
        <div class="miniCard">
          <div class="kpiLabel muted">Watching</div>
          <div class="kpiValue" id="kpiWatching">–</div>
        </div>
        <div class="miniCard">
          <div class="kpiLabel muted">Waiting Next Season</div>
          <div class="kpiValue" id="kpiWaiting">–</div>
        </div>
        <div class="miniCard">
          <div class="kpiLabel muted">Watched</div>
          <div class="kpiValue" id="kpiWatched">–</div>
        </div>
      </div>
    <p id="homeMsg" class="muted"></p>

      <section class="card innerCard" id="app" style="display:none; margin-top:14px;">
        <h3>Add show</h3>

       <form id="addForm" class="grid">
  <input name="title" placeholder="Title" required />

  <!-- STATUS -->
  <select name="status" id="status">
    <option>To Be Watched</option>
    <option>Watching</option>
    <option>Watched</option>
    <option>Dropped</option>
    <option>Waiting for Next Season</option>
  </select>

  <!-- Watching-only block -->
  <div id="progressBlock" class="progressBlock" style="display:none;">
    <label class="field">
      <span>Current season</span>
      <input type="number" name="current_season" min="1" step="1" />
    </label>

    <label class="field">
      <span>Current episode</span>
      <input type="number" name="current_episode" min="1" step="1" />
    </label>
  </div>

  <!-- CATEGORY -->
  <select name="category" id="category">
    <option value="Anime">Anime</option>
    <option value="Non-anime" selected>Non-anime</option>
  </select>

  <!-- TYPE (ONLY ONE) -->
  <select name="show_type" id="show_type">
    <option value="">Type (optional)</option>
    <option value="TV">TV</option>
    <option value="Movie">Movie</option>
    <option value="TV &amp; Movie">TV &amp; Movie</option>
  </select>

  <!-- Ongoing -->
  <select name="ongoing" id="ongoing">
    <option value="">Is the Show Ongoing? (optional)</option>
    <option>Yes</option>
    <option>No</option>
    <option>On Hiatus</option>
    <option>To Be Released</option>
  </select>

  <label class="field">
    <span>Date Released</span>
    <input type="date" name="release_date" />
  </label>

  <!-- TV-only block -->
  <div id="tvBlock" class="typeBlock" style="display:none;">
    <label class="field">
      <span># Seasons</span>
      <input type="number" name="seasons" min="0" step="1" />
    </label>

    <label class="field">
      <span># Episodes</span>
      <input type="number" name="episodes" min="0" step="1" />
    </label>

    <label class="field">
      <span>Episode length (min)</span>
      <input type="number" name="episode_length_min" min="0" step="1" />
    </label>
  </div>

  <!-- Movie-only block -->
  <div id="movieBlock" class="typeBlock" style="display:none;">
    <label class="field">
      <span># Movies</span>
      <input type="number" name="movies" min="0" step="1" />
    </label>

    <label class="field">
      <span>Movie length (min)</span>
      <input type="number" name="movie_length_min" min="0" step="1" />
    </label>
  </div>

  <!-- Anime-only block -->
  <div id="ovaBlock" class="ovaBlock" style="display:none;">
    <label class="field">
      <span># OVAs</span>
      <input type="number" name="ovas" min="0" step="1" />
    </label>

    <label class="field">
      <span>OVA length (min)</span>
      <input type="number" name="ova_length_min" min="0" step="1" />
    </label>
  </div>

  <!-- Rating -->
  <div class="starField">
    <label>My rating</label>
    <div class="stars" id="ratingStars">
      <span class="star" data-value="1">☆</span>
      <span class="star" data-value="2">☆</span>
      <span class="star" data-value="3">☆</span>
      <span class="star" data-value="4">☆</span>
      <span class="star" data-value="5">☆</span>
      <span class="starClear secondary" id="clearRating">Clear</span>
    </div>
    <input type="hidden" name="my_rating" id="my_rating" />
  </div>

<div class="multiselect">
  <label>Studio</label>
  <button type="button" id="studioBtn" class="secondary">Select studios</button>
  <div id="studioMenu" class="menu hidden"></div>
  <div id="studioChips" class="chips"></div>
</div>



  <div class="multiselect">
    <label>Where to Watch</label>
    <button type="button" id="platformBtn" class="secondary">Select platforms</button>
    <div id="platformMenu" class="menu hidden"></div>
    <div id="platformChips" class="chips"></div>
  </div>

  <div class="multiselect">
    <label>Genres</label>
    <button type="button" id="genreBtn" class="secondary">Select genres</button>
    <div id="genreMenu" class="menu hidden"></div>
    <div id="genreChips" class="chips"></div>
  </div>

  <div class="multiselect">
    <label>Tropes</label>
    <button type="button" id="tropeBtn" class="secondary">Select tropes</button>
    <div id="tropeMenu" class="menu hidden"></div>
    <div id="tropeChips" class="chips"></div>
  </div>

  <textarea name="notes" placeholder="Notes"></textarea>
  <button type="submit">Add</button>
</form>

      </section>
    </section>

    <!-- BROWSE -->
    <section class="card view" id="view-browse" style="display:none;">
      <h2>Browse</h2>

      <div class="filters">
        <input id="q" placeholder="Search title…" />

        <select id="statusFilter">
          <option value="">All statuses</option>
          <option>To Be Watched</option>
          <option>Watching</option>
          <option>Watched</option>
          <option>Dropped</option>
          <option>Waiting for Next Season</option>
        </select>

        <select id="platformFilter">
          <option value="">All platforms</option>
        </select>

        <select id="genreFilter">
          <option value="">All genres</option>
        </select>

        <select id="tropeFilter">
          <option value="">All tropes</option>
        </select>

        <input id="studioFilter" placeholder="Studio contains…" />

        <select id="minRatingFilter">
          <option value="">Any rating</option>
          <option value="1">★ and up</option>
          <option value="2">★★ and up</option>
          <option value="3">★★★ and up</option>
          <option value="4">★★★★ and up</option>
          <option value="5">★★★★★</option>
        </select>

        <div class="filterBtns">
          <button id="clearFilters" class="secondary" type="button">Clear</button>
          <button id="refresh" class="secondary" type="button">Refresh</button>
        </div>
      </div>

      <table id="table">
        <thead>
          <tr>
            <th>Title</th><th>Status</th><th>Rating</th><th>Platforms</th><th>Genres</th><th>Tropes</th><th>Studio</th><th>Last Watched</th><th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <p id="msg" class="muted"></p>
    </section>

  <!-- COLLECTION -->
<section class="card view" id="view-collection" style="display:none;">
  <h2>My Collection</h2>
  <p class="muted">
    This will be your “library view” (everything you’ve watched / rated), with a toggle for Anime vs Non-anime.
  </p>

  <div class="row">
    <select id="collectionGroup">
      <option value="">All</option>
      <option value="Anime">Anime</option>
      <option value="Non-anime">Non-anime</option>
    </select>

    <select id="collectionSort">
      <option value="recent">Recently watched</option>
      <option value="rating">Highest rated</option>
      <option value="alpha">A → Z</option>
    </select>
  </div>

  <div id="collectionList" style="margin-top: 10px;"></div>
  <p id="collectionMsg" class="muted"></p>
</section>

      <!-- SHOW DETAILS (ONLY ONE, NOT NESTED) -->
    <section class="card view" id="view-show" style="display:none;">
      <div class="row" style="justify-content: space-between;">
        <div>
          <h2 id="showTitle">Show</h2>
          <p class="muted" id="showMeta"></p>
        </div>
      
        <div class="row">
          <button id="backToCollection" type="button" class="secondary">← Back</button>
          <button id="fetchAnimeBtn" type="button" class="secondary">Fetch anime info</button>
          <button id="inlineEditBtn" type="button" class="secondary">Edit</button>

          <button id="inlineSaveBtn" type="button" style="display:none;">Save</button>
          <button id="inlineCancelBtn" type="button" class="secondary" style="display:none;">Cancel</button>
        </div>
      </div>
      
      <p id="showDetailMsg" class="muted" style="margin-top:8px;"></p>
      <img id="showPoster" style="max-width:160px;border-radius:12px;display:none;" />

      <div class="grid" style="margin-top:12px;">
        <div class="card innerCard">
          <h3 style="margin-top:0;">Description</h3>
          <div id="showDescriptionBlock"></div>
        </div>
      
        <div class="card innerCard">
          <h3 style="margin-top:0;">Your Info</h3>
          <div id="showFactsBlock"></div>
        </div>
      </div>
      
      <div class="card innerCard" style="margin-top:12px;">
        <h3 style="margin-top:0;">Tags</h3>
        <div id="showTags"></div>
      </div>
      
      <div class="card innerCard" style="margin-top:12px;">
        <h3 style="margin-top:0;">Notes</h3>
        <div id="showNotesBlock"></div>
      </div>
      
      
        <p id="editMsg" class="muted" style="margin-top:8px;"></p>
      </section>
        <form id="editForm" class="grid" style="display:none; margin-top:10px;">
          <label class="field">
            <span>Status</span>
            <select name="status" id="edit_status">
              <option>To Be Watched</option>
              <option>Watching</option>
              <option>Watched</option>
              <option>Dropped</option>
              <option>Waiting for Next Season</option>
            </select>
          </label>
      
          <label class="field">
            <span>Rating (0–5)</span>
            <input type="number" name="rating_stars" id="edit_rating" min="0" max="5" step="1" />
          </label>
      
          <label class="field">
            <span>Last Watched</span>
            <input type="date" name="last_watched" id="edit_last_watched" />
          </label>
      
          <label class="field">
            <span>Current Season</span>
            <input type="number" name="current_season" id="edit_current_season" min="1" step="1" />
          </label>
      
          <label class="field">
            <span>Current Episode</span>
            <input type="number" name="current_episode" id="edit_current_episode" min="1" step="1" />
          </label>
      
          <label class="field" style="grid-column: 1 / -1;">
            <span>Description</span>
            <textarea name="description" id="edit_description" rows="3"></textarea>
          </label>
      
          <label class="field" style="grid-column: 1 / -1;">
            <span>Notes</span>
            <textarea name="notes" id="edit_notes" rows="3"></textarea>
          </label>
      
          <div class="card innerCard" style="grid-column:1 / -1;">
            <h4 style="margin:0 0 8px 0;">Rewatch</h4>
      
            <label class="field">
              <span>Rewatch Count</span>
              <input type="number" name="rewatch_count" id="edit_rewatch_count" min="0" step="1" />
            </label>
      
            <label class="field">
              <span>Currently Rewatching?</span>
              <select name="is_rewatching" id="edit_is_rewatching">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </label>
      
            <label class="field">
              <span>Last Rewatch Date</span>
              <input type="date" name="last_rewatch_date" id="edit_last_rewatch_date" />
            </label>
          </div>
        </form>
      </div>
    </section>
  </main>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
  const SUPABASE_URL = "https://lldpkdwbnlqfuwjbbirt.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxsZHBrZHdibmxxZnV3amJiaXJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTc3NTcsImV4cCI6MjA4NjQzMzc1N30.OGKn4tElV2k1_ZJKOVjPxBSQUixZB5ywMYo5eGZTDe4";

  // Make it available to app.js
  window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

<script type="module" src="./app.js"></script>


</body>
</html>
